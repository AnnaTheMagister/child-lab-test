name: üöÄ Deploy WordPress Theme via FTP

on:
  push:
    branches: ["main"] # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Node.js (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è FTP-–∫–ª–∏–µ–Ω—Ç–∞ lftp)
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–æ—â–Ω—ã–π FTP-–∫–ª–∏–µ–Ω—Ç lftp
      - name: üì¶ Install LFTP
        run: sudo apt-get update && sudo apt-get install -y lftp

      # 4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã —Å —Ö–æ—Å—Ç–∏–Ω–≥–æ–º
      - name: üì§ Sync files to FTP server
        run: |
          lftp -e "
            set ftp:ssl-allow no;
            set ssl:verify-certificate no;
            open ${{ secrets.FTP_HOST }};
            user ${{ secrets.FTP_USERNAME }} '${{ secrets.FTP_PASSWORD }}';
            mirror --reverse --verbose --delete \
                   --ignore-time \
                   --exclude-glob .git/ \
                   --exclude-glob .github/ \
                   ./ ${{ secrets.REMOTE_PATH }};
            bye;
          "
