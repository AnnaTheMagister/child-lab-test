<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tag Graph Demo - –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: rgba(255,255,255,0.8);
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .panels {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .controls, .tag-editor {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            flex: 1;
            min-width: 300px;
        }
        
        .tag-editor {
            min-width: 350px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group h3, .tag-editor h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .direction-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .direction-btn {
            padding: 10px;
        }
        
        .direction-btn.horizontal {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .direction-btn.vertical {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        .direction-btn.auto {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .text-orientation-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .text-orientation-btn {
            padding: 10px;
        }
        
        .text-orientation-btn.horizontal {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }
        
        .text-orientation-btn.vertical {
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
            color: #333;
        }
        
        select, input[type="range"], input[type="text"], input[type="color"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            margin-bottom: 10px;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .range-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .range-group input[type="range"] {
            flex: 1;
        }
        
        .range-value {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: #667eea;
        }
        
        .graph-container {
            width: 100%;
            height: 650px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .info-panel {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        
        .info-panel h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            padding: 15px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-top: 5px;
        }
        
        .instructions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #4CAF50;
        }
        
        .instructions h4 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .instructions ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .instructions li {
            margin-bottom: 8px;
            color: #555;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        
        .instructions li:before {
            content: "‚Ä¢";
            color: #4CAF50;
            font-weight: bold;
        }
        
        .json-editor {
            margin-top: 20px;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            margin-bottom: 10px;
            background: #f8f9fa;
        }
        
        .json-buttons {
            display: flex;
            gap: 10px;
        }
        
        .json-buttons button {
            flex: 1;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .panels {
                flex-direction: column;
            }
            
            .graph-container {
                height: 500px;
            }
            
            .buttons-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .direction-buttons, .text-orientation-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ –ì—Ä–∞—Ñ —Ç–µ–≥–æ–≤ —Å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–µ–π —Ç–µ–∫—Å—Ç–∞</h1>
        <div class="subtitle">–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –º–µ–Ω—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞ ‚Ä¢ –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –º–µ–Ω—è–µ—Ç –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞</div>
        
        <div class="panels">
            <div class="controls">
                <div class="control-group">
                    <h3>üìê –†–µ–∂–∏–º—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è</h3>
                    <div class="buttons-grid">
                        <button id="horizontalBtn">
                            <span>‚Üí</span> –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
                        </button>
                        <button id="verticalBtn">
                            <span>‚Üì</span> –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ
                        </button>
                        <button id="circularBtn">
                            <span>‚≠ï</span> –ö—Ä—É–≥–æ–≤–æ–π
                        </button>
                        <button id="gridBtn">
                            <span>‚ñ¶</span> –°–µ—Ç–∫–∞
                        </button>
                        <button id="manualBtn">
                            <span>üñ±Ô∏è</span> –†—É—á–Ω–æ–π
                        </button>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∞</h3>
                    <div class="range-group">
                        <label>–ö—Ä–∏–≤–∏–∑–Ω–∞ –ª–∏–Ω–∏–π:</label>
                        <input type="range" id="curveSlider" min="0" max="1" step="0.1" value="0.5">
                        <span id="curveValue" class="range-value">0.5</span>
                    </div>
                    <div class="range-group">
                        <label>–¢–æ–ª—â–∏–Ω–∞ –ª–∏–Ω–∏–π:</label>
                        <input type="range" id="widthSlider" min="1" max="10" step="1" value="3">
                        <span id="widthValue" class="range-value">3</span>
                    </div>
                    <div class="range-group">
                        <label>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ:</label>
                        <input type="range" id="spacingSlider" min="50" max="300" step="10" value="100">
                        <span id="spacingValue" class="range-value">100</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–æ–º</h3>
                    <div class="buttons-grid">
                        <button id="addTagBtn">
                            <span>‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥
                        </button>
                        <button id="exportBtn">
                            <span>üíæ</span> –≠–∫—Å–ø–æ—Ä—Ç JSON
                        </button>
                        <button id="importBtn">
                            <span>üìÇ</span> –ò–º–ø–æ—Ä—Ç JSON
                        </button>
                        <button id="resetBtn">
                            <span>üîÑ</span> –°–±—Ä–æ—Å
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="tag-editor">
                <div class="control-group">
                    <h3>üè∑Ô∏è –†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–≥–∞</h3>
                    <div id="selectedTagInfo">
                        <p style="color: #666; text-align: center; padding: 20px;">
                            –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–≥ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                        </p>
                    </div>
                    <div id="tagEditorControls" style="display: none;">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                            <input type="text" id="tagNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                        </div>
                        <div class="form-group">
                            <label>–¶–≤–µ—Ç:</label>
                            <input type="color" id="tagColorInput" value="#667eea">
                        </div>
                        <div class="form-group">
                            <label>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞:</label>
                            <div class="direction-buttons">
                                <button class="direction-btn horizontal" data-direction="h">
                                    ‚Üí –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ
                                </button>
                                <button class="direction-btn vertical" data-direction="v">
                                    ‚Üì –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ
                                </button>
                                <button class="direction-btn auto" data-direction="auto">
                                    ‚Üª –ê–≤—Ç–æ
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞:</label>
                            <div class="text-orientation-buttons">
                                <button class="text-orientation-btn horizontal" data-orientation="horizontal">
                                    ‚Üî –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è
                                </button>
                                <button class="text-orientation-btn vertical" data-orientation="vertical">
                                    ‚Üï –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è
                                </button>
                            </div>
                        </div>
                        <div class="buttons-grid">
                            <button id="updateTagBtn">
                                <span>‚úì</span> –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                            <button id="deleteTagBtn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <span>üóëÔ∏è</span> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-label">–í—Å–µ–≥–æ —Ç–µ–≥–æ–≤</div>
                            <div class="stat-value" id="tagCount">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">–°–≤—è–∑–µ–π</div>
                            <div class="stat-value" id="connectionCount">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">–†–µ–∂–∏–º</div>
                            <div class="stat-value" id="layoutMode">horizontal</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="graph" class="graph-container"></div>
        
        <div class="info-panel">
            <div class="instructions">
                <h4>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é</h4>
                <ul>
                    <li><strong>–õ–µ–≤—ã–π –∫–ª–∏–∫</strong> - –≤—ã–±—Ä–∞—Ç—å —Ç–µ–≥ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</li>
                    <li><strong>–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫</strong> –Ω–∞ —Ç–µ–≥ - –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (‚Üí, ‚Üì, ‚Üª)</li>
                    <li><strong>–ü—Ä–∞–≤—ã–π –∫–ª–∏–∫</strong> –Ω–∞ —Ç–µ–≥ - –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞ (‚Üî, ‚Üï)</li>
                    <li><strong>–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ</strong> - –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–µ–≥</li>
                    <li><strong>–¢—Ä–æ–π–Ω–æ–µ –∫–∞—Å–∞–Ω–∏–µ</strong> –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º - –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞</li>
                </ul>
            </div>
            
            <div class="json-editor">
                <h3>üìù –†–µ–¥–∞–∫—Ç–æ—Ä JSON</h3>
                <textarea id="jsonEditor" placeholder='–í—Å—Ç–∞–≤—å—Ç–µ JSON –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–∫—É—â–∏–π...'></textarea>
                <div class="json-buttons">
                    <button id="updateFromJsonBtn">
                        <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å –∏–∑ JSON
                    </button>
                    <button id="copyJsonBtn">
                        <span>üìã</span> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞ -->
    <div id="addTagModal" class="modal">
        <div class="modal-content">
            <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–µ–≥</h3>
            <div class="form-group">
                <label>ID (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π):</label>
                <input type="text" id="newTagId" placeholder="tag-id" value="">
            </div>
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                <input type="text" id="newTagName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞">
            </div>
            <div class="form-group">
                <label>–¶–≤–µ—Ç:</label>
                <input type="color" id="newTagColor" value="#667eea">
            </div>
            <div class="form-group">
                <label>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞:</label>
                <select id="newTagDirection">
                    <option value="h">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ (‚Üí)</option>
                    <option value="v">–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ (‚Üì)</option>
                    <option value="auto">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ (‚Üª)</option>
                </select>
            </div>
            <div class="form-group">
                <label>–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞:</label>
                <select id="newTagTextOrientation">
                    <option value="horizontal">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è (‚Üî)</option>
                    <option value="vertical">–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è (‚Üï)</option>
                </select>
            </div>
            <div class="buttons-grid">
                <button id="confirmAddTagBtn">
                    <span>‚úì</span> –î–æ–±–∞–≤–∏—Ç—å
                </button>
                <button id="cancelAddTagBtn" style="background: #6c757d;">
                    <span>‚úï</span> –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ JSON -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <h3>üìÇ –ò–º–ø–æ—Ä—Ç JSON</h3>
            <p>–í—Å—Ç–∞–≤—å—Ç–µ JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∞:</p>
            <textarea id="importJsonTextarea" placeholder='{"tags": [...], "connections": [...], "config": {...}}' rows="10"></textarea>
            <div class="buttons-grid">
                <button id="confirmImportBtn">
                    <span>üì•</span> –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button id="cancelImportBtn" style="background: #6c757d;">
                    <span>‚úï</span> –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <script src="tag-graph.js"></script>
    <script>
        // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ –∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è–º–∏ —Ç–µ–∫—Å—Ç–∞
        const initialTags = [
            { id: 'react', name: 'React', color: '#61DAFB', direction: 'h', textOrientation: 'horizontal' },
            { id: 'typescript', name: 'TypeScript', color: '#3178C6', direction: 'h', textOrientation: 'horizontal' },
            { id: 'nodejs', name: 'Node.js', color: '#339933', direction: 'v', textOrientation: 'vertical' },
            { id: 'graphql', name: 'GraphQL', color: '#E10098', direction: 'v', textOrientation: 'vertical' },
            { id: 'mongodb', name: 'MongoDB', color: '#47A248', direction: 'auto', textOrientation: 'horizontal' },
            { id: 'docker', name: 'Docker', color: '#2496ED', direction: 'auto', textOrientation: 'vertical' },
            { id: 'aws', name: 'AWS', color: '#FF9900', direction: 'h', textOrientation: 'horizontal' },
            { id: 'kubernetes', name: 'Kubernetes', color: '#326CE5', direction: 'v', textOrientation: 'vertical' }
        ];
        
        const initialConnections = [
            { source: 'react', target: 'typescript', strength: 0.9 },
            { source: 'react', target: 'graphql', strength: 0.7 },
            { source: 'nodejs', target: 'typescript', strength: 0.8 },
            { source: 'nodejs', target: 'mongodb', strength: 0.6 },
            { source: 'nodejs', target: 'graphql', strength: 0.8 },
            { source: 'docker', target: 'nodejs', strength: 0.7 },
            { source: 'docker', target: 'aws', strength: 0.6 },
            { source: 'docker', target: 'kubernetes', strength: 0.8 },
            { source: 'aws', target: 'kubernetes', strength: 0.7 },
            { source: 'mongodb', target: 'aws', strength: 0.5 }
        ];
        
        let graph;
        let selectedTagId = null;
        
        function initGraph() {
            graph = new TagGraph({
                container: document.getElementById('graph'),
                tags: JSON.parse(JSON.stringify(initialTags)),
                connections: JSON.parse(JSON.stringify(initialConnections)),
                layout: 'horizontal',
                spacing: 120,
                padding: 60,
                curveIntensity: 0.5,
                lineWidth: 3,
                textOrientation: 'horizontal',
                backgroundColor: '#f8f9fa',
                interactive: true,
                onTagClick: (tag) => {
                    selectedTagId = tag.id;
                    updateTagEditor();
                    updateInfoPanel();
                    console.log('–í—ã–±—Ä–∞–Ω —Ç–µ–≥:', tag.name);
                },
                onTagDrag: (tag, x, y) => {
                    console.log(`–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ ${tag.name}`);
                },
                onTagDirectionChange: (tag) => {
                    console.log(`–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ${tag.name} –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞: ${tag.direction}`);
                    updateTagEditor();
                    updateInfoPanel();
                    updateJSONEditor();
                },
                onTagTextOrientationChange: (tag) => {
                    console.log(`–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ ${tag.name} –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ${tag.textOrientation}`);
                    updateTagEditor();
                    updateInfoPanel();
                    updateJSONEditor();
                }
            });
            
            updateInfoPanel();
            updateJSONEditor();
        }
        
        function updateInfoPanel() {
            document.getElementById('tagCount').textContent = graph.getTags().length;
            document.getElementById('connectionCount').textContent = graph.getConnections().length;
            document.getElementById('layoutMode').textContent = graph.config.layout;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const stats = graph.getTagStats();
            console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∞—Ñ–∞:', stats);
        }
        
        function updateTagEditor() {
            const tagEditor = document.getElementById('tagEditorControls');
            const tagInfo = document.getElementById('selectedTagInfo');
            
            if (selectedTagId) {
                const tag = graph.getTags().find(t => t.id === selectedTagId);
                if (tag) {
                    tagEditor.style.display = 'block';
                    tagInfo.style.display = 'none';
                    
                    document.getElementById('tagNameInput').value = tag.name;
                    document.getElementById('tagColorInput').value = tag.color;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    document.querySelectorAll('.direction-btn').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.direction === tag.direction) {
                            btn.classList.add('active');
                        }
                    });
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞
                    document.querySelectorAll('.text-orientation-btn').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.orientation === tag.textOrientation) {
                            btn.classList.add('active');
                        }
                    });
                }
            } else {
                tagEditor.style.display = 'none';
                tagInfo.style.display = 'block';
            }
        }
        
        function updateJSONEditor() {
            const json = graph.exportAsJSON();
            document.getElementById('jsonEditor').value = JSON.stringify(json, null, 2);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ layout
        document.getElementById('horizontalBtn').addEventListener('click', () => {
            graph.setLayout('horizontal');
            updateButtons('horizontalBtn');
            updateInfoPanel();
            updateJSONEditor();
        });
        
        document.getElementById('verticalBtn').addEventListener('click', () => {
            graph.setLayout('vertical');
            updateButtons('verticalBtn');
            updateInfoPanel();
            updateJSONEditor();
        });
        
        document.getElementById('circularBtn').addEventListener('click', () => {
            graph.setLayout('circular');
            updateButtons('circularBtn');
            updateInfoPanel();
            updateJSONEditor();
        });
        
        document.getElementById('gridBtn').addEventListener('click', () => {
            graph.setLayout('grid');
            updateButtons('gridBtn');
            updateInfoPanel();
            updateJSONEditor();
        });
        
        document.getElementById('manualBtn').addEventListener('click', () => {
            graph.setLayout('manual');
            updateButtons('manualBtn');
            updateInfoPanel();
            updateJSONEditor();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–ª–∞–π–¥–µ—Ä–æ–≤
        document.getElementById('curveSlider').addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            document.getElementById('curveValue').textContent = value.toFixed(1);
            graph.setConfig({ curveIntensity: value });
            updateJSONEditor();
        });
        
        document.getElementById('widthSlider').addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            document.getElementById('widthValue').textContent = value;
            graph.setConfig({ lineWidth: value });
            updateJSONEditor();
        });
        
        document.getElementById('spacingSlider').addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            document.getElementById('spacingValue').textContent = value;
            graph.setConfig({ spacing: value });
            graph.calculateLayout();
            graph.render();
            updateJSONEditor();
        });
        
        // –ö–Ω–æ–ø–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —Ç–µ–≥–∞
        document.querySelectorAll('.direction-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (selectedTagId) {
                    const direction = btn.dataset.direction;
                    graph.setTagDirection(selectedTagId, direction);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                    document.querySelectorAll('.direction-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    
                    updateJSONEditor();
                }
            });
        });
        
        // –ö–Ω–æ–ø–∫–∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —Ç–µ–≥–∞
        document.querySelectorAll('.text-orientation-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (selectedTagId) {
                    const orientation = btn.dataset.orientation;
                    graph.setTagTextOrientation(selectedTagId, orientation);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                    document.querySelectorAll('.text-orientation-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    
                    updateJSONEditor();
                }
            });
        });
        
        // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–æ–º
        document.getElementById('updateTagBtn').addEventListener('click', () => {
            if (selectedTagId) {
                const name = document.getElementById('tagNameInput').value;
                const color = document.getElementById('tagColorInput').value;
                
                graph.updateTag(selectedTagId, { name, color });
                updateJSONEditor();
            }
        });
        
        document.getElementById('deleteTagBtn').addEventListener('click', () => {
            if (selectedTagId && confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–µ–≥?')) {
                graph.removeTag(selectedTagId);
                selectedTagId = null;
                updateTagEditor();
                updateInfoPanel();
                updateJSONEditor();
            }
        });
        
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞
        const addTagModal = document.getElementById('addTagModal');
        const importModal = document.getElementById('importModal');
        
        document.getElementById('addTagBtn').addEventListener('click', () => {
            document.getElementById('newTagId').value = 'tag-' + Date.now();
            document.getElementById('newTagName').value = '';
            document.getElementById('newTagColor').value = '#667eea';
            addTagModal.style.display = 'flex';
        });
        
        document.getElementById('confirmAddTagBtn').addEventListener('click', () => {
            const newTag = {
                id: document.getElementById('newTagId').value,
                name: document.getElementById('newTagName').value,
                color: document.getElementById('newTagColor').value,
                direction: document.getElementById('newTagDirection').value,
                textOrientation: document.getElementById('newTagTextOrientation').value
            };
            
            if (newTag.name) {
                graph.addTag(newTag);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Å–≤—è–∑—å
                const existingTags = graph.getTags().filter(t => t.id !== newTag.id);
                if (existingTags.length > 0) {
                    const randomTag = existingTags[Math.floor(Math.random() * existingTags.length)];
                    graph.addConnection({
                        source: newTag.id,
                        target: randomTag.id,
                        strength: Math.random() * 0.5 + 0.5
                    });
                }
                
                addTagModal.style.display = 'none';
                updateInfoPanel();
                updateJSONEditor();
            } else {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞!');
            }
        });
        
        document.getElementById('cancelAddTagBtn').addEventListener('click', () => {
            addTagModal.style.display = 'none';
        });
        
        // –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç JSON
        document.getElementById('exportBtn').addEventListener('click', () => {
            const json = graph.exportAsJSON();
            const dataStr = JSON.stringify(json, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'tag-graph-' + new Date().toISOString().slice(0,10) + '.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        });
        
        document.getElementById('importBtn').addEventListener('click', () => {
            document.getElementById('importJsonTextarea').value = '';
            importModal.style.display = 'flex';
        });
        
        document.getElementById('confirmImportBtn').addEventListener('click', () => {
            try {
                const jsonText = document.getElementById('importJsonTextarea').value;
                const jsonData = JSON.parse(jsonText);
                
                if (!jsonData.tags || !jsonData.connections) {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON');
                }
                
                graph.importFromJSON(jsonData);
                selectedTagId = null;
                updateTagEditor();
                updateInfoPanel();
                updateJSONEditor();
                importModal.style.display = 'none';
                
                alert('–ì—Ä–∞—Ñ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ JSON!');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON: ' + error.message);
            }
        });
        
        document.getElementById('cancelImportBtn').addEventListener('click', () => {
            importModal.style.display = 'none';
        });
        
        document.getElementById('updateFromJsonBtn').addEventListener('click', () => {
            try {
                const jsonText = document.getElementById('jsonEditor').value;
                const jsonData = JSON.parse(jsonText);
                
                if (!jsonData.tags || !jsonData.connections) {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON');
                }
                
                graph.importFromJSON(jsonData);
                selectedTagId = null;
                updateTagEditor();
                updateInfoPanel();
                
                alert('–ì—Ä–∞—Ñ –æ–±–Ω–æ–≤–ª–µ–Ω –∏–∑ JSON!');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ JSON: ' + error.message);
            }
        });
        
        document.getElementById('copyJsonBtn').addEventListener('click', () => {
            const jsonEditor = document.getElementById('jsonEditor');
            jsonEditor.select();
            document.execCommand('copy');
            
            // –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞
            const originalText = jsonEditor.value;
            jsonEditor.value = '‚úÖ JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!';
            setTimeout(() => {
                jsonEditor.value = originalText;
            }, 1500);
        });
        
        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≥—Ä–∞—Ñ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é?')) {
                graph.destroy();
                initGraph();
                selectedTagId = null;
                updateTagEditor();
                updateButtons('horizontalBtn');
            }
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
        window.addEventListener('click', (e) => {
            if (e.target === addTagModal) {
                addTagModal.style.display = 'none';
            }
            if (e.target === importModal) {
                importModal.style.display = 'none';
            }
        });
        
        function updateButtons(activeId) {
            ['horizontalBtn', 'verticalBtn', 'circularBtn', 'gridBtn', 'manualBtn'].forEach(id => {
                const btn = document.getElementById(id);
                if (id === activeId) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initGraph);
        
        // –ü—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ JSON —Å —Ä–∞–∑–Ω—ã–º–∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è–º–∏ —Ç–µ–∫—Å—Ç–∞
        function loadExampleJSON() {
            const exampleJSON = {
                "tags": [
                    { "id": "frontend", "name": "Frontend Development", "color": "#FF6B6B", "direction": "h", "textOrientation": "horizontal", "x": 150, "y": 150 },
                    { "id": "backend", "name": "Backend Systems", "color": "#4ECDC4", "direction": "v", "textOrientation": "vertical", "x": 400, "y": 150 },
                    { "id": "database", "name": "Database Management", "color": "#FFD166", "direction": "h", "textOrientation": "vertical", "x": 650, "y": 150 },
                    { "id": "devops", "name": "DevOps & Infrastructure", "color": "#06D6A0", "direction": "v", "textOrientation": "horizontal", "x": 400, "y": 350 },
                    { "id": "mobile", "name": "Mobile Development", "color": "#118AB2", "direction": "auto", "textOrientation": "horizontal", "x": 150, "y": 350 },
                    { "id": "ai", "name": "AI & Machine Learning", "color": "#EF476F", "direction": "auto", "textOrientation": "vertical", "x": 650, "y": 350 }
                ],
                "connections": [
                    { "source": "frontend", "target": "backend", "strength": 0.9 },
                    { "source": "backend", "target": "database", "strength": 0.8 },
                    { "source": "backend", "target": "devops", "strength": 0.7 },
                    { "source": "devops", "target": "database", "strength": 0.6 },
                    { "source": "frontend", "target": "mobile", "strength": 0.7 },
                    { "source": "mobile", "target": "backend", "strength": 0.6 },
                    { "source": "backend", "target": "ai", "strength": 0.5 },
                    { "source": "database", "target": "ai", "strength": 0.8 }
                ],
                "config": {
                    "layout": "manual",
                    "spacing": 120,
                    "padding": 60,
                    "curveIntensity": 0.4,
                    "lineWidth": 4,
                    "textOrientation": "horizontal"
                }
            };
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            setTimeout(() => {
                if (confirm('–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä –≥—Ä–∞—Ñ–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è–º–∏ —Ç–µ–∫—Å—Ç–∞?')) {
                    graph.importFromJSON(exampleJSON);
                    updateInfoPanel();
                    updateJSONEditor();
                }
            }, 2000);
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
        window.addEventListener('load', () => {
            setTimeout(loadExampleJSON, 1000);
        });
    </script>
</body>
</html>